---
title: "Deploying Online Retriever Service"
icon: "server"
---

To support scenarios such as multi-turn reasoning that require dynamic retrieval, UltraRAG supports deploying the Retriever as an online service, enabling other pipelines to make asynchronous HTTP calls.

## Overview

We have implemented online Retriever service deployment based on Flask, supporting asynchronous requests and remote access, and it can work with local or distributed pipelines.

## Deploying the Online Retriever Service

The deployment process is similar to a normal pipelineâ€”just execute a dedicated YAML configuration for service deployment:

```yaml
# MCP Server
servers:
  retriever: servers/retriever

# MCP Client Pipeline
pipeline:
- retriever.retriever_init
- retriever.retriever_deploy_service
```

Run the following command to generate the corresponding configuration file:

```shell
ultrarag build examples/deploy_retriever.yaml
```

Then edit the generated parameter configuration:

```yaml
retriever:
  corpus_path: data/sample_hotpotqa_corpus_5.jsonl
  cuda_devices: 0,1
  faiss_use_gpu: true
  index_path: index/index.index
  infinity_kwargs:
    batch_size: 1024
    bettertransformer: false
    device: cuda
    pooling_method: auto
  retriever_path: openbmb/MiniCPM-Embedding-Light
  retriever_url: http://localhost:8080
```

ðŸ“Œ Configuration notes:
- `retriever_url`: The service listening address, in the format `http://<host>:<port>`.
  - For local deployment: `127.0.0.1:5112` is recommended.
  - For remote deployment: `0.0.0.0:<port>` is recommended (to support cross-host access).

It is recommended to run the service in the background:

```shell
# Start and detach the service using screen
screen -S retriever
ultrarag run examples/deploy_retriever.yaml
# Detach with Ctrl + A + D
# To resume later: screen -r retriever
```

Or use nohup to write logs and run in the background:

```shell
nohup ultrarag run examples/deploy_retriever.yaml > retriever.log 2>&1 &
```

After the service starts, it will listen on the specified port, waiting to receive retrieval requests from other pipelines.

## Calling the Online Retriever Service

To call the online service, simply use the `retriever.retriever_deploy_search` tool in your pipeline (no need to initialize retriever anymore):

```yaml
servers:
  retriever: servers/retriever
  benchmark: servers/benchmark

# MCP Client Pipeline
pipeline:
- benchmark.get_data
- retriever.retriever_deploy_search
```

This way, you can directly send local queries to the remote retrieval service and get the corresponding document results.