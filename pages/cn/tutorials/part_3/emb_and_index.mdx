---
title: "è¯­æ–™åº“ç¼–ç ä¸Žç´¢å¼•"
icon: "file-magnifying-glass"
---

åœ¨å®žé™…åº”ç”¨ä¸­ï¼ŒRAG ç³»ç»Ÿå¾€å¾€éœ€è¦åœ¨ç™¾ä¸‡ä¹ƒè‡³åƒä¸‡çº§åˆ«çš„è¯­æ–™åº“ä¸­è¿›è¡Œé«˜æ•ˆæ£€ç´¢ã€‚ä¸ºæ­¤ï¼ŒUltraRAG æ”¯æŒå°†åŽŸå§‹è¯­æ–™è¿›è¡ŒåµŒå…¥ç¼–ç ï¼ˆembeddingï¼‰å¹¶æž„å»ºé«˜æ•ˆç´¢å¼•ï¼ˆindexï¼‰ï¼Œä»¥æ”¯æ’‘å¤§è§„æ¨¡è¯­ä¹‰æ£€ç´¢çš„éœ€æ±‚ã€‚

æœ¬èŠ‚å°†ä»‹ç»å¦‚ä½•åŸºäºŽ UltraRAG ç¼–å†™å¯¹åº”çš„ pipelineï¼Œå¹¶å®Œæˆè¯­æ–™çš„åµŒå…¥ä¸Žç´¢å¼•è¿‡ç¨‹ã€‚

## æ­¥éª¤ 1ï¼šç¼–å†™ Pipeline YAML æ–‡ä»¶

åœ¨ `examples/` ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª YAML æ–‡ä»¶ï¼ˆå¦‚ `corpus_index.yaml`ï¼‰ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```yaml examples/corpus_index.yaml icon="/images/yaml.svg"
# MCP Server
servers:
  retriever: servers/retriever

# MCP Client Pipeline
pipeline:
- retriever.retriever_init
- retriever.retriever_embed
- retriever.retriever_index
```


## æ­¥éª¤ 2ï¼šæž„å»º Pipeline å¹¶é…ç½®å‚æ•°

è¿è¡Œä»¥ä¸‹å‘½ä»¤æž„å»º pipelineï¼š

```shell
ultrarag build examples/corpus_index.yaml
```

éšåŽä¼šç”Ÿæˆä¸€ä¸ªå‚æ•°é…ç½®æ–‡ä»¶ï¼Œå¯æ ¹æ®å…·ä½“éœ€æ±‚ä¿®æ”¹å¯¹åº”å­—æ®µã€‚ä¾‹å¦‚ï¼š

```yaml examples/parameter/corpus_index_parameter.yaml icon="/images/yaml.svg"
retriever:
  corpus_path: data/sample_hotpotqa_corpus_5.jsonl       # è¾“å…¥è¯­æ–™è·¯å¾„ï¼ˆJSONL æ ¼å¼ï¼‰
  retriever_path: openbmb/MiniCPM-Embedding-Light        # æ£€ç´¢æ¨¡åž‹åç§°æˆ–è·¯å¾„
  embedding_path: embedding/embedding.npy                # ä¿å­˜åµŒå…¥å‘é‡çš„è·¯å¾„
  index_path: index/index.index                          # ä¿å­˜ç´¢å¼•æ–‡ä»¶çš„è·¯å¾„
  faiss_use_gpu: true                                    # æ˜¯å¦å¯ç”¨ GPU åŠ é€Ÿ
  index_chunk_size: 50000                                # æž„å»ºç´¢å¼•æ—¶çš„åˆ†å—å¤§å°
  cuda_devices: 0,1                                      # ä½¿ç”¨çš„ GPU è®¾å¤‡ç¼–å·
  overwrite: false                                       # æ˜¯å¦è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶
  infinity_kwargs:                                       # åµŒå…¥å¼•æ“Žç›¸å…³é…ç½®
    batch_size: 1024
    bettertransformer: false
    device: cuda
    pooling_method: auto
```

## æ­¥éª¤ 3ï¼šè¿è¡Œ Pipeline è¿›è¡Œç¼–ç ä¸Žç´¢å¼•

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥è¿è¡Œè¯­æ–™åº“å¤„ç†æµç¨‹ï¼š

```shell
ultrarag run examples/corpus_index.yaml
```

ðŸ“Œ æç¤ºï¼šç”±äºŽç¼–ç ä¸Žç´¢å¼•è¿‡ç¨‹å¯èƒ½æ¶‰åŠå¤§è§„æ¨¡è¯­æ–™ï¼Œè¿è¡Œæ—¶é—´è¾ƒé•¿ï¼Œå»ºè®®ä½¿ç”¨ screen æˆ– nohup å°†ä»»åŠ¡æŒ‚åˆ°åŽå°è¿è¡Œï¼Œä¾‹å¦‚ï¼š

```shell
nohup ultrarag run examples/corpus_index.yaml > log.txt 2>&1 &
```