---
title: "Prompt Server"
icon: "square-terminal"
---

## ä»€ä¹ˆæ˜¯ Prompt Tool

Prompt Tool æ˜¯ UltraRAG-MCP ä¸­ç”¨äºæ„å»ºè¯­è¨€æ¨¡å‹è¾“å…¥çš„ç»„ä»¶ã€‚

æ¯ä¸ª Prompt Tool ç”± @app.prompt è£…é¥°å®šä¹‰ï¼Œå…¶ä¸»è¦èŒè´£æ˜¯æ ¹æ®é—®é¢˜ã€æ£€ç´¢æ®µç­‰è¾“å…¥ï¼ŒåŠ è½½æ¨¡æ¿æ–‡ä»¶å¹¶ç”Ÿæˆæ ‡å‡†åŒ–çš„ prompt messageï¼Œå¯ç›´æ¥ä¼ é€’ç»™ LLM æ¨¡å‹è¿›è¡Œç”Ÿæˆã€‚

## å¦‚ä½•å®ç°ä¸€ä¸ª Prompt Toolï¼Ÿ

å®ç°ä¸€ä¸ª Prompt Tool é€šå¸¸åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡ Prompt æ¨¡æ¿ï¼ˆJinja2 æ ¼å¼ï¼‰

è¯·å°†ä½ çš„ prompt æ¨¡æ¿ä¿å­˜ä¸º `.jinja` ç»“å°¾çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š

```jinja
Please answer the following question based on the given documents.
Think step by step.
Provide your final answer in the format \boxed{answer}.

Documents:
{{documents}}

Question: {{question}}
```

### ç¬¬äºŒæ­¥ï¼šåœ¨ Prompt Server ä¸­å®ç° Tool

è°ƒç”¨æˆ‘ä»¬æä¾›çš„ `load_prompt_template` æ–¹æ³•åŠ è½½æ¨¡æ¿ï¼Œå¹¶åœ¨Prompt Serverä¸­å®ç°ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼ˆToolï¼‰ç”¨äºç»„è£… promptã€‚

```python
@app.prompt(output="q_ls,ret_psg,template->prompt_ls")
def qa_rag_boxed(
    q_ls: List[str], ret_psg: List[str | Any], template: str | Path
) -> list[PromptMessage]:
    template: Template = load_prompt_template(template)
    ret = []
    for q, psg in zip(q_ls, ret_psg):
        passage_text = "\n".join(psg)
        p = template.render(question=q, documents=passage_text)
        ret.append(p)
    return ret
```

### ç¬¬ä¸‰æ­¥ï¼šåœ¨ Pipeline ä¸­ä½¿ç”¨è¯¥ Tool

1. åœ¨ YAML é…ç½®æ–‡ä»¶ä¸­æ³¨å†Œ Prompt Server å¹¶è°ƒç”¨ä½ å®ç°çš„ Toolï¼š

```yaml
# MCP Server
servers:
  generation: servers/generation
  prompt: servers/prompt

# MCP Client Pipeline
pipeline:
- prompt.qa_rag_boxed
- generation.generate
```

2. æ„å»ºåï¼Œä¿®æ”¹è¿è¡Œæ—¶å‚æ•°ï¼ŒæŒ‡å®šä½ çš„æ¨¡æ¿æ–‡ä»¶è·¯å¾„ï¼š

```yaml
prompt:
  template: prompt/qa_rag_boxed.jinja
```

ğŸš© è¿™æ ·ï¼Œä½ å³å¯å®ç°è‡ªå®šä¹‰ Prompt æ„å»ºä¸è°ƒç”¨ï¼Œæå¤§æå‡ LLM åº”ç”¨æµç¨‹çš„å¯å¤ç”¨æ€§ä¸æ‰©å±•æ€§ã€‚