---
title: "éƒ¨ç½²åœ¨çº¿ Retriever æœåŠ¡"
icon: "server"
---

ä¸ºäº†æ»¡è¶³å¤šè½®æ¨ç†ç­‰éœ€è¦åŠ¨æ€æ£€ç´¢çš„åœºæ™¯ï¼ŒUltraRAG æ”¯æŒå°† Retriever éƒ¨ç½²ä¸ºåœ¨çº¿æœåŠ¡ï¼Œä¾›å…¶ä»–æµç¨‹é€šè¿‡å¼‚æ­¥ HTTP è°ƒç”¨ã€‚

## åŠŸèƒ½ç®€ä»‹

æˆ‘ä»¬åŸºäº Flask å®ç°äº† Retriever çš„åœ¨çº¿æœåŠ¡éƒ¨ç½²ï¼Œæ”¯æŒå¼‚æ­¥è¯·æ±‚ä¸è¿œç¨‹è®¿é—®ï¼Œå¯ä¸æœ¬åœ°æˆ–åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ pipeline ååŒå·¥ä½œã€‚

## éƒ¨ç½²åœ¨çº¿retrieveræœåŠ¡

éƒ¨ç½²æµç¨‹ä¸æ™®é€š pipeline ç±»ä¼¼ï¼Œåªéœ€æ‰§è¡Œä¸€ä¸ªä¸“ç”¨äºæœåŠ¡éƒ¨ç½²çš„ YAML é…ç½®ï¼š

```yaml examples/deploy_retriever.yaml icon="/images/yaml.svg"
# MCP Server
servers:
  retriever: servers/retriever

# MCP Client Pipeline
pipeline:
- retriever.retriever_init
- retriever.retriever_deploy_service
```

è¿è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæˆå¯¹åº”é…ç½®æ–‡ä»¶ï¼š

```shell
ultrarag build examples/deploy_retriever.yaml
```

ç„¶åç¼–è¾‘ç”Ÿæˆçš„å‚æ•°é…ç½®ï¼š

```yaml examples/parameter/deploy_retriever_parameter.yaml icon="/images/yaml.svg"
retriever:
  corpus_path: data/sample_hotpotqa_corpus_5.jsonl
  cuda_devices: 0,1
  faiss_use_gpu: true
  index_path: index/index.index
  infinity_kwargs:
    batch_size: 1024
    bettertransformer: false
    device: cuda
    pooling_method: auto
  retriever_path: openbmb/MiniCPM-Embedding-Light
  retriever_url: http://localhost:8080
```

ğŸ“Œ **é…ç½®è¯´æ˜ï¼š**
- `retriever_url`ï¼šæœåŠ¡ç›‘å¬åœ°å€ï¼Œæ ¼å¼ä¸º `http://<host>:<port>`ã€‚
  - æœ¬åœ°éƒ¨ç½²æ¨èï¼š`127.0.0.1:5112`
  - è¿œç¨‹éƒ¨ç½²æ¨èï¼š`0.0.0.0:<port>`ï¼ˆä»¥æ”¯æŒè·¨ä¸»æœºè®¿é—®ï¼‰

æ¨èä½¿ç”¨`åå°æ–¹å¼`è¿è¡ŒæœåŠ¡ï¼š

```shell
# ä½¿ç”¨ screen å¯åŠ¨å¹¶æŒ‚èµ·æœåŠ¡
screen -S retriever
ultrarag run examples/deploy_retriever.yaml
# æŒ‰ Ctrl + A + D æŒ‚èµ·
# åç»­æ¢å¤ï¼šscreen -r retriever
```

æˆ–ä½¿ç”¨ nohup å†™å…¥æ—¥å¿—è¿è¡Œï¼š

```shell
nohup ultrarag run examples/deploy_retriever.yaml > retriever.log 2>&1 &
```

æœåŠ¡å¯åŠ¨åå°†ç›‘å¬æŒ‡å®šç«¯å£ï¼Œç­‰å¾…æ¥æ”¶æ¥è‡ªå…¶ä»–æµç¨‹çš„æ£€ç´¢è¯·æ±‚ã€‚

## è°ƒç”¨åœ¨çº¿ retriever æœåŠ¡

è°ƒç”¨åœ¨çº¿æœåŠ¡ä»…éœ€åœ¨ pipeline ä¸­ä½¿ç”¨ `retriever.retriever_deploy_search` å·¥å…·ï¼ˆä¸å†éœ€è¦åˆå§‹åŒ– retrieverï¼‰ï¼š

```yaml examples/retriever_deploy_search.yaml icon="/images/yaml.svg"
servers:
  retriever: servers/retriever
  benchmark: servers/benchmark

# MCP Client Pipeline
pipeline:
- benchmark.get_data
- retriever.retriever_deploy_search
```

è¿™æ ·å³å¯å°†æœ¬åœ°æŸ¥è¯¢ç›´æ¥å‘é€è‡³è¿œç¨‹æ£€ç´¢æœåŠ¡ï¼Œå¹¶è·å–å¯¹åº”çš„æ–‡æ¡£ç»“æœã€‚